{
    "$id": "id://config.global",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "type": "object",
    "additionalProperties": false,
    "properties": {
        "protocol": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "ackWaitMs": {
                    "type": "integer", "minimum": 1, "default": 250,
                    "x-meta": { "visibility": "advanced", "mutable": "runtime", "summary": "ACK wait window (ms)" }
                },
                "graceWindowMs": {
                    "type": "integer", "minimum": 0, "default": 150,
                    "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                },
                "maxInFlightPerLane": {
                    "type": "integer", "minimum": 1, "maximum": 4096, "default": 64,
                    "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                },
                "heartbeatMs": { "type": "integer", "minimum": 100, "default": 5000,
                    "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                },
                "maxQueue": { "type": "integer", "minimum": 1, "default": 1024,
                    "x-meta": { "visibility": "hidden", "mutable": "locked" }
                },
                "maxOfflineQueue": { "type": "integer", "minimum": 0, "default": 2000,
                    "x-meta": { "visibility": "hidden", "mutable": "locked" }
                }
            },
            "required": ["ackWaitMs","graceWindowMs","maxInFlightPerLane","heartbeatMs","maxQueue","maxOfflineQueue"],
            "default": {}
        },
        "reconnect": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "initialDelayMs": {
                    "type": "integer", "minimum": 0, "default": 500,
                    "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                },
                "maxDelayMs": {
                    "type": "integer", "minimum": 1, "default": 15000,
                    "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                },
                "factor": {
                    "type": "number", "minimum": 1.0, "maximum": 10.0, "default": 2.0,
                    "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                },
                "jitterRatio": {
                    "type": "number", "minimum": 0.0, "maximum": 1.0, "default": 0.25,
                    "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                }
            },
            "required": ["initialDelayMs","maxDelayMs","factor","jitterRatio"],
            "default": {}
        },
        "timeouts": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "classes":  {
                    "type": "object", "additionalProperties": false,
                    "properties": {
                        "request.fast": {
                            "type": "object", "additionalProperties": false,
                            "properties": {
                                "serviceTtlMs": {
                                    "type": "integer", "minimum": 1, "default": 800,
                                    "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                                },
                                "clientPatienceExtraMs": {
                                    "type": "integer", "minimum": 0, "default": 150,
                                    "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                                }
                            },
                            "required": ["serviceTtlMs","clientPatienceExtraMs"],
                            "default": {}
                        },
                        "request.medium": {
                            "type": "object",
                            "additionalProperties": false,
                            "properties": {
                                "serviceTtlMs": {
                                    "type": "integer", "minimum": 1, "default": 3000,
                                    "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                                },
                                "clientPatienceExtraMs": {
                                    "type": "integer", "minimum": 0, "default": 200,
                                    "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                                }
                            },
                            "required": ["serviceTtlMs","clientPatienceExtraMs"],
                            "default": {}
                        },
                        "request.heavy": {
                            "type": "object",
                            "additionalProperties": false,
                            "properties": {
                                "serviceTtlMs": {
                                    "type": "integer", "minimum": 1, "default": 30000,
                                    "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                                },
                                "clientPatienceExtraMs": {
                                    "type": "integer", "minimum": 0, "default": 250,
                                    "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                                }
                            },
                            "required": ["serviceTtlMs","clientPatienceExtraMs"],
                            "default": {}
                        }
                    },
                    "required": ["request.fast","request.medium","request.heavy"],
                    "default": {}
                }
            },
            "required": ["classes"],
            "default": {}
        },
        "streams": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "default": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "targetHz": {
                            "type": "integer", "minimum": 1, "maximum": 240, "default": 10,
                            "x-meta": { "visibility": "public", "mutable": "runtime", "summary": "Desired stream update rate" }
                        },
                        "maxQueueMs": {
                            "type": "integer", "minimum": 1, "default": 200,
                            "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                        },
                        "coalesce": {
                            "type": "string", "enum": ["drop-oldest","drop-newest","none"], "default": "drop-oldest",
                            "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                        }
                    },
                    "required": ["targetHz","maxQueueMs","coalesce"],
                    "default": {}
                }
            },
            "required": ["default"],
            "default": {}
        },
        "http": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "retry": {
                    "type": "integer", "minimum": 0, "maximum": 10, "default": 2,
                    "x-meta": { "visibility": "public", "mutable": "runtime" }
                },
                "backoff": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "baseMs": {
                            "type": "integer", "minimum": 1, "default": 250,
                            "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                        },
                        "maxMs": {
                            "type": "integer", "minimum": 1, "default": 1000,
                            "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                        },
                        "jitterPct": {
                            "type": "integer", "minimum": 0, "maximum": 100, "default": 30,
                            "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                        }
                    },
                    "required": ["baseMs","maxMs","jitterPct"],
                    "default": {}
                },
                "timeoutCapMs": {
                    "type": "integer", "minimum": 1, "default": 30000,
                    "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                },
                "cookie": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "sameSite": {
                            "type": "string", "enum": ["lax","strict","none"], "default": "lax",
                            "x-meta": { "visibility": "advanced", "mutable": "startup" }
                        },
                        "secure": {
                            "type": "boolean", "default": false,
                            "x-meta": { "visibility": "advanced", "mutable": "startup" }
                        },
                        "maxAgeSec": {
                            "type": "integer", "minimum": 0, "default": 2592000,
                            "x-meta": { "visibility": "advanced", "mutable": "startup" }
                        }
                    },
                    "required": ["sameSite","secure","maxAgeSec"],
                    "default": {}
                },
                    "cors": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "allowOrigins": {
                            "type": "array",
                            "items": { "type": "string", "format": "uri" },
                            "default": ["http://localhost:5173","http://127.0.0.1:5173"],
                            "x-meta": { "visibility": "advanced", "mutable": "startup" }
                        }
                    },
                    "required": ["allowOrigins"],
                    "default": {}
                }
            },
            "required": ["retry","backoff","timeoutCapMs","cookie","cors"],
            "default": {}
        },
        "mods": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "allowSymlinks": {
                    "type": "boolean", "default": false,
                    "x-meta": { "visibility": "advanced", "mutable": "startup" }
                }
            },
            "required": ["allowSymlinks"],
            "default": {}
        },
        "httpProxy": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "allowList": {
                    "type": "array",
                    "items": { "type": "string" },
                    "default": ["httpbin.org","api.openai.com","localhost","127.0.0.1","::1"],
                    "x-meta": { "visibility": "advanced", "mutable": "startup" }
                },
                "buckets": {
                    "type": "object",
                    "additionalProperties": {
                        "type": "object",
                        "properties": {
                            "rpm": { "type": "integer", "minimum": 1, "default": 600 },
                            "burst": { "type": "integer", "minimum": 1, "default": 200 }
                        },
                        "required": ["rpm","burst"],
                        "additionalProperties": false
                    },
                    "default": { "default": { "rpm": 600, "burst": 200 } },
                    "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                },
                "requestHeaders": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "mode": {
                            "type": "string", "enum": ["block","allow"], "default": "block",
                            "x-meta": { "visibility": "advanced", "mutable": "startup" }
                        },
                        "list": {
                            "type": "array", "items": { "type": "string" },
                            "default": ["host","connection","content-length","cookie"],
                            "x-meta": { "visibility": "advanced", "mutable": "startup" }
                        },
                        "perHost": {
                            "type": "object", "default": {},
                            "x-meta": { "visibility": "advanced", "mutable": "startup" }
                        },
                        "perCap": {
                            "type": "object", "default": {},
                            "x-meta": { "visibility": "advanced", "mutable": "startup" }
                        }
                    },
                    "required": ["mode","list"],
                    "default": {}
                },
                "responseHeaders": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "mode": {
                            "type": "string", "enum": ["block","allow"], "default": "allow",
                            "x-meta": { "visibility": "advanced", "mutable": "startup" }
                        },
                        "list": {
                            "type": "array", "items": { "type": "string" },
                            "default": ["content-type","content-length","cache-control"],
                            "x-meta": { "visibility": "advanced", "mutable": "startup" }
                        },
                        "perHost": {
                            "type": "object", "default": {},
                            "x-meta": { "visibility": "advanced", "mutable": "startup" }
                        },
                        "perCap": {
                            "type": "object", "default": {},
                            "x-meta": { "visibility": "advanced", "mutable": "startup" }
                        }
                    },
                    "required": ["mode","list"],
                    "default": {}
                }
            },
            "required": ["allowList","buckets","requestHeaders","responseHeaders"],
            "default": {}
        },
        "debug": {
            "type": "object",
            "additionalProperties": false,
                "properties": {
            "devModeEnabled": {
                "type": "boolean", "default": true,
                "x-meta": { "visibility": "public", "mutable": "runtime" }
            },
            "tracingEnabled": {
                "type": "boolean", "default": true,
                "x-meta": { "visibility": "public", "mutable": "runtime" }
            },
            "suppressRecurringMessages": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                        "enabled": {
                            "type": "boolean", "default": true,
                            "x-meta": { "visibility": "public", "mutable": "runtime" }
                        },
                        "windowSeconds": {
                                "type": "integer", "minimum": 1, "default": 60,
                            "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                        },
                        "maxPerWindow": {
                                "type": "integer", "minimum": 1, "default": 5,
                            "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                        },
                        "summaryLevel": {
                                "type": "string", "enum": ["DEBUG","INFO","WARN","ERROR"], "default": "INFO",
                            "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                        }
                    },
                    "required": ["enabled","windowSeconds","maxPerWindow","summaryLevel"],
                    "default": {}
                },
                "tracebackCharLimit": {
                    "type": "integer", "minimum": 0, "default": 4000,
                    "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                },
                "backend": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "rpc": {
                            "type": "object",
                            "additionalProperties": false,
                            "properties": {
                                "maxPreviewChars": {
                                    "type": "integer", "minimum": 0, "default": 1000000,
                                    "x-meta": { "visibility": "hidden", "mutable": "locked" }
                                },
                                "incomingMessages": {
                                    "type": "object",
                                    "properties": {
                                        "log": {
                                            "type": "boolean", "default": true,
                                            "x-meta": { "visibility": "public", "mutable": "runtime" }
                                        },
                                        "ignoreTypes": {
                                            "type": "array", "items": { "type": "string" }, "default": ["ack","heartbeat"],
                                            "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                                        }
                                    },
                                    "required": ["log","ignoreTypes"],
                                    "additionalProperties": false,
                                    "default": {}
                                },
                                "outgoingMessages": {
                                    "type": "object",
                                    "properties": {
                                        "log": {
                                            "type": "boolean", "default": true,
                                            "x-meta": { "visibility": "public", "mutable": "runtime" }
                                        },
                                        "ignoreTypes": {
                                            "type": "array", "items": { "type": "string" }, "default": ["ack","heartbeat"],
                                            "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                                        },
                                        "rules": {
                                            "type": "array", "items": { "type": "object" }, "default": [],
                                            "x-meta": { "visibility": "advanced", "mutable": "runtime" }
                                        }
                                    },
                                    "required": ["log","ignoreTypes","rules"],
                                    "additionalProperties": false,
                                    "default": {}
                                }
                            },
                            "required": ["maxPreviewChars","incomingMessages","outgoingMessages"],
                            "default": {}
                        }
                    },
                    "required": ["rpc"],
                    "default": {}
                },
                "frontend": {
                    "type": "object", "additionalProperties": true, "default": {}
                }
            },
            "required": ["devModeEnabled","tracingEnabled","suppressRecurringMessages","tracebackCharLimit","backend","frontend"],
            "default": {}
        }
    },
    "required": ["protocol","reconnect","timeouts","streams","http","mods","httpProxy","debug"],
    "x-meta": { "visibility": "hidden", "mutable": "locked" }
}
