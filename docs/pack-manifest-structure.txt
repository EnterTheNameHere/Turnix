TURNIX PACK MANIFEST STRUCTURE (DRAFT)
======================================

File name (recommended):
    manifest.json5    (JSON5; JSON is a valid subset)

All manifests share a common base structure, with additional fields depending
on "kind" (appPack, viewPack, contentPack, mod, savePack).


--------------------------------------
1. COMMON FIELDS (ALL KINDS)
--------------------------------------

kind (required)
    Type: string
    Allowed values:
        "appPack"
        "viewPack"
        "contentPack"
        "mod"
        "savePack"

    Meaning:
        Declares the category of this pack. Determines which additional fields
        are allowed/required.

author (optional)
    Type: string OR object

    a) String form:
        "author": "Turnix"

    b) Object form:
        "author": {
            "name":  "Turnix",
            "email": "dev@example.com",   // optional
            "url":   "https://example"    // optional
        }

    Internal model:
        AuthorInfo:
            name:  str | None
            email: str | None
            url:   str | None

    Semantics:
        - If string: treated as AuthorInfo(name=<string>).
        - If object: fields populate AuthorInfo.
        - May be omitted; effectiveAuthor is resolved in PackMeta (inherit or
          "unknown").

contributors (optional)
    Type: array of string OR AuthorInfo objects

    Example:
        "contributors": [
            "Alice",
            { "name": "Bob", "email": "bob@example.com" }
        ]

    Semantics:
        - Informational only (metadata for humans / UI).

id (required)
    Type: string
    Allowed characters:
        [A–Z, a–z, 0–9, "_", "-"]
    Disallowed:
        ".", "@", whitespace, other punctuation.

    This is the PackLocalId (local identifier).
    Hierarchical ids (packTreeId) are built by the loader using parent
    relationships; the manifest "id" is always a single segment and never
    includes dots or "@", and never contains version information.

name (optional)
    Type: string
    Default:
        If omitted, the user-facing name is derived from `id`.

    Semantics:
        - Friendly display name in UI (PackManager, lists).
        - Does not affect identity or resolution.

version (optional)
    Type: string (SemVerPackVersion)

    Example:
        "version": "1.2.3"

    Default:
        - If omitted, the pack has no declared version; effectiveSemVerPackVersion
          will be inherited from parent or assigned by engine in PackMeta.

description (optional)
    Type: string
    Default: None

license (optional)
    Type: string
    Default: None
    Example:
        "MIT"
        "GPL-3.0-only"

keywords (optional)
    Type: array of strings
    Default: None

homepage (optional)
    Type: string (URL)
    Default: None

repository (optional)
    Type: string OR object
    Examples:
        "repository": "https://github.com/user/repo"

        "repository": {
            "type": "git",
            "url":  "https://github.com/user/repo.git"
        }

    Semantics:
        - Informational; for linking to source code or homepage.

visibility (optional)
    Type: string
    Allowed values:
        "public"
        "private"

    Semantics:
        - Controls whether this pack is considered externally visible or
          internal-only inside its parent pack tree.

    Defaults (effectiveVisibility):
        - For a root pack (no parent):
              default is "public" if visibility is omitted.
        - For a child pack (nested inside another pack):
              if visibility is omitted, inherit parent's effectiveVisibility.
        - A manifest that explicitly sets "visibility" always overrides the
          inherited value.

    Effect:
        - The PackMetaRegistry treats a pack as a candidate for global
          resolution only if:
              effectiveVisibility == "public"
              AND all ancestors allow exporting it (see exportNestedPacks).
        - Packs with effectiveVisibility == "private" can still be used
          internally by their parent tree but are not targetable by external
          PackRequests.

exportNestedPacks (optional)
    Type:
        - boolean, OR
        - array of PackLocalId strings

    Examples:
        "exportNestedPacks": true
        "exportNestedPacks": false
        "exportNestedPacks": ["assets", "assets.ui"]

    Semantics:
        - Controls which child packs become globally exported when building
          PackMetaRegistry.

        - If boolean:
            true  -> all child packs whose effectiveVisibility == "public"
                     are exported / registered globally.
            false -> children are not exported globally, even if visible;
                     they remain internal to this pack tree.

        - If array of PackLocalId:
            Only the listed child ids are exported globally (provided their
            effectiveVisibility == "public"). Other children are internal.

    Defaults:
        - If exportNestedPacks is omitted:
            Suggested policy:
              kind == "contentPack":
                  exportNestedPacks defaults to true
              kind in {"appPack", "viewPack", "mod", "savePack"}:
                  exportNestedPacks defaults to false
            Exact defaults are defined by the loader, but should be consistent
            with this policy.

    Combined effect with visibility:
        - A nested child pack appears in the global PackMetaRegistry only if:
            (a) its effectiveVisibility == "public", AND
            (b) at least one ancestor has exportNestedPacks == true, or
                a list that explicitly includes this child id.

        - The parent pack is responsible for deciding whether its children are
          exposed as part of a public surface or treated as internal modules.


--------------------------------------
2. DEPENDENCIES FIELD
--------------------------------------

packs (optional)
    Type: array of PackRefString

    Example:
        "packs": [
            "Turnix@ui@^2",
            "Anthony@avatars",
            "main-menu.service@^1.3.0"
        ]

    PackRefString grammar (recap):
        [<author>"@"]<packTreeId>["@"<SemVerPackRequirement>]

        Examples:
            "avatars"
            "Anthony@avatars"
            "Turnix@ui.trace.trace-list@2.5.3"
            "Turnix@main-menu.ui@^3"

    Semantics:
        - Declares other packs this pack depends on.
        - Parsed into PackRequest at load time.
        - Resolution is done via PackResolver using PackMetaRegistry.
        - Applies to all kinds:
            - appPack: packs required by this application.
            - viewPack: packs required by this view.
            - contentPack: packs required to interpret its content.
            - mod: packs it depends on (shared services, UI controls, etc.).
            - savePack: packs referenced for reconstruction (typically with
              overrides).


--------------------------------------
3. ASSET DECLARATION
--------------------------------------

Manifest key: "assets"
    Type: array of string or object entries.
    Optional; default: no public assets.

    Purpose:
        - Declare asset directories and explicit asset files that are exposed
          for use by mods and views.

3.1 String entries
    "assets": [
        "assets",
        "images/portraits"
    ]

    Semantics:
        - Each string entry is a directory path relative to pack root.
        - At discovery, the engine recursively scans this directory.
        - All files with "safe" extensions are automatically exposed (images,
          text, config, etc., as defined by engine).
        - No explicit list needed for typical image/config packs.

3.2 Object entries
    "assets": [
        "assets",
        {
            "dir": "raw-avatars",
            "files": ["avatar.dat", "special/mesh.bin"],
            "safeAuto": false
        }
    ]

    Fields:
        dir (required)
            Type: string
            Meaning: directory under pack root.

        files (optional)
            Type: array of strings
            Meaning: explicit file paths (relative to "dir") to include even if
                     their extensions are not in the safe list.

        safeAuto (optional)
            Type: boolean
            Default: true

            If true:
                - Auto-include safe files under dir recursively, plus listed
                  files.
            If false:
                - Include ONLY the listed files.

    Safe extensions (engine-defined; examples):
        .png, .jpg, .jpeg, .webp, .gif
        .txt, .json, .json5, .yml, .yaml, .toml, .ini, .csv, .tsv
        (and optionally some audio/font types)

    Anything not in safe list is only included if explicitly listed in "files".


--------------------------------------
4. NESTED VISIBILITY, EXPORTS AND IMPORT
--------------------------------------

This section ties together:
    - visibility
    - exportNestedPacks
    - capability exports
    - importFromParent

4.1 Capability exports

exports (optional)
    Type: object

    Example:

        "exports": {
            "capabilities": ["Button", "TraceListView"]
        }

    Fields:
        capabilities (optional)
            Type: array of strings

            Semantics:
                - Named capabilities this pack provides (for example, UI
                  components, services).
                - Exact semantics are defined by the capability system.
                - This is purely a declaration; the capability framework
                  interprets it.

    Note:
        - Previous ideas around exports.packs have been superseded by the
          combination of per-pack "visibility" and the parent's
          "exportNestedPacks" setting.
        - If a legacy manifest defines exports.packs, the loader may translate
          those entries into exportNestedPacks = [ ... ] at load time.

4.2 Import from parent (dependency inheritance)

importFromParent (optional)
    Type: boolean OR object

    Simple form:
        "importFromParent": true

        Semantics:
            - If true, this pack implicitly inherits its parent pack's "packs"
              as dependencies, in addition to its own "packs" list.
            - If false, only this manifest's "packs" list is considered.

    Extended form (reserved for future use):
        "importFromParent": {
            "packs": true
        }

    Defaults:
        - If kind == "viewPack":
              importFromParent defaults to false.
        - For other kinds (appPack, contentPack, mod, savePack):
              importFromParent defaults to true, unless overridden by manifest
              or global configuration.

    Example (viewPack without inheritance):
        {
          "kind": "viewPack",
          "id": "trace-monitor",
          "packs": [
            "Turnix@trace-service@^1"
          ]
          // importFromParent omitted -> defaults to false for viewPack
          // does NOT automatically inherit appPack.packs
        }

    Example (viewPack with inheritance):
        {
          "kind": "viewPack",
          "id": "trace-monitor",
          "importFromParent": true,
          "packs": [
            "Turnix@trace-service@^1"
          ]
          // Inherits appPack.packs plus its own "packs" list
        }


--------------------------------------
5. KIND-SPECIFIC FIELDS
--------------------------------------

In addition to the common fields above, each kind may declare a dedicated
top-level block for kind-specific configuration. These blocks are mutually
exclusive by kind:

    kind == "appPack"    -> "app": { ... }
    kind == "viewPack"   -> "view": { ... }
    kind == "contentPack"-> "content": { ... }
    kind == "mod"        -> "mod": { ... }
    kind == "savePack"   -> "save": { ... }

Exact schemas for these blocks are defined in more detailed documents. This
section only sketches the expected shape and intention.

5.1 appPack

    Required:
        kind: "appPack"
        id: <PackLocalId>

    Kind-specific block:
        app (required for appPack)
            Type: object

            Expected fields (examples, not exhaustive):
                "runtimes": {
                    "python"?: {
                        "generator": "generator.py",
                        "entry": "src/main.py"
                    },
                    "javascript"?: {
                        "generator": "generator.js",
                        "entry": "src/main.js"
                    }
                },
                "defaultInstanceId": "turnix-main-menu",
                "initialState": { ... }

            Exact semantics are defined in the app runtime specification.

    Other applicable fields:
        packs: [...]           (dependencies)
        assets: [...]          (optional)
        visibility: ...        (optional)
        exportNestedPacks: ... (optional)
        importFromParent:      (rarely used; appPack is typically a root)

    Semantics:
        - Top-level application definition.
        - Owns child packs in its directory tree (viewPacks, mods,
          contentPacks).
        - Responsible for defining how an AppInstance is created and saved.

5.2 viewPack

    Required:
        kind: "viewPack"
        id: <PackLocalId>

    Kind-specific block:
        view (required for viewPack)
            Type: object

            Expected fields (examples):
                "viewKind": "main" | "trace-monitor" | ...,
                "layout": { ... },          // layout / UI config
                "runtimes": { ... }         // if view has its own JS entrypoint

    Other applicable fields:
        packs: [...]           (dependencies)
        assets: [...]          (optional)
        visibility: ...        (optional)
        exportNestedPacks: ... (optional)
        importFromParent:      (defaults to false unless explicitly set)

    Semantics:
        - Defines a specific View (browser tab/window, 3D client, etc.).
        - May inherit parent appPack’s packs via importFromParent.
        - Contains mods and contentPacks that are only relevant to this view.

5.3 contentPack

    Required:
        kind: "contentPack"
        id: <PackLocalId>

    Kind-specific block:
        content (optional)
            Type: object

            Example fields:
                "category": "ui-controls" | "avatars" | "levels" | ...,
                "schema": "..."      // content schema hint
                "loader": "..."      // optional content loader hint

    Other applicable fields:
        packs: [...]           (dependencies)
        assets: [...]          (common here)
        visibility: ...        (optional)
        exportNestedPacks: ... (optional; typically default true for this kind)
        importFromParent:      (defaults to true unless overridden)

    Semantics:
        - Holds assets and possibly child mods and other packs.
        - Typical use: UI control library, avatar pack, level pack.
        - Often acts as a container that exports nested packs via
          exportNestedPacks and per-child visibility settings.

5.4 mod

    Required:
        kind: "mod"
        id: <PackLocalId>

    Kind-specific block:
        mod (required for mod)
            Type: object

            Expected fields:
                "runtimes": {
                    "python"?: {
                        "entry": "backend_mod.py"
                    },
                    "javascript"?: {
                        "entry": "frontend_mod.js"
                    }
                },
                "permissions": [
                    "rpc:trace.read@^1",
                    "rpc:trace.write@^1"
                ],
                "hooks": {
                    // hook-specific configuration if needed
                }

    Other applicable fields:
        packs: [...]           (dependencies on other packs)
        assets: [...]          (optional)
        visibility: ...        (optional)
        exportNestedPacks: ... (optional)
        importFromParent:      (defaults to true unless overridden)

    Semantics:
        - Executable code unit.
        - Provides Python and/or JavaScript entries for runtime.
        - Can register capabilities and services; may export them via
          exports.capabilities.

5.5 savePack

    Required:
        kind: "savePack"
        id: <PackLocalId>

    Kind-specific block:
        save (optional)
            Type: object

            Example fields:
                "appInstanceId": "turnix-main-menu",
                "createdTs": 1700000000,
                "appPack": "appPack://Turnix@main-menu:1.0.0",
                "requestedPacks": { ... },
                "resolvedPacks": { ... }

            Exact schema is defined in the save-pack specification.

    Other applicable fields:
        packs: [...]           (snapshot of packs used for AppInstance
                               reconstruction)
        assets: [...]          (per-save assets, data files)
        visibility: ...        (optional; usually "private" since savePacks
                               are tied to a specific workspace)
        exportNestedPacks: ... (optional)
        importFromParent:      (defaults to true unless overridden)

    Semantics:
        - Holds save-specific state and possibly per-save overrides of other
          packs.
        - Resolution rules prioritize the savePack layer when conflicts exist
          with external packs.


--------------------------------------
6. DEFAULTS AND HANDLING OF MISSING FIELDS
--------------------------------------

- author:
    - If missing: effectiveAuthor inherited from parent or set to "unknown".

- version:
    - If missing: no declared version; effectiveSemVerPackVersion inherited
      from parent or engine default.
    - Version semantics (SemVerPackVersion, SemVerPackRequirement) handled by
      the SemVer resolver.

- name:
    - If missing: use `id` (PackLocalId) as user-facing name.

- packs:
    - If missing: pack has no declared dependencies.

- assets:
    - If missing: pack exposes no public assets.

- visibility:
    - If missing:
        - Root pack (no parent): default to "public".
        - Nested pack: inherit parent's effectiveVisibility.
    - A manifest that sets visibility explicitly overrides the inherited value.

- exportNestedPacks:
    - If missing:
        Suggested policy:
            kind == "contentPack":
                default to true
            kind in {"appPack", "viewPack", "mod", "savePack"}:
                default to false
    - Exact defaults are defined by the loader but should remain stable across
      versions to keep resolution predictable.

- importFromParent:
    - If missing:
        - For kind == "viewPack": default to false.
        - For other kinds: default to true.
    - This influences dependency inheritance, not visibility.

- exports:
    - If missing:
        - No capabilities are declared as exported.
        - Nested pack visibility is controlled solely by visibility and
          exportNestedPacks.


End of manifest structure spec (draft).


--------------------------------------
7. COMPATIBILITY / RELATIONSHIP HINTS
--------------------------------------

These fields are OPTIONAL and are NOT enforced by PackResolver.
They are for Mod/Packs Manager UI and tooling (suggestions, badges, warnings).

All three share the same value shape:

    - Either a simple PackRefString:
        "Turnix@turnix.ui@^3"

    - Or an object:
        {
          "id": "Turnix@turnix.ui@^3",
          "reason": "Includes standard UI controls used by this pack"
        }

    Where "id" is a PackRefString (author@packTreeId@SemVerPackRequirement).


recommendedPacks (optional)
    Type: array of (PackRefString OR object with "id" and "reason")

    Example:
        "recommendedPacks": [
          "Turnix@turnix.ui@^3",
          { "id": "Anthony@avatars@1", "reason": "Provides default avatars" }
        ]

    Semantics:
        - "These packs are not required, but are known to enhance or complement
           this pack."
        - Mod/Packs Manager may:
            - highlight them when this pack is selected,
            - offer quick "install/enable recommended packs" actions.


supportedPacks (optional)
    Type: array of (PackRefString OR object with "id" and "reason")

    Example:
        "supportedPacks": [
          "OtherDev@combat-system@^2",
          {
            "id": "trevor@story-mode@^1",
            "reason": "Explicitly tested with story mode v1.x"
          }
        ]

    Semantics:
        - "These packs are explicitly tested and known to work with this pack."
        - UI may show "supported" badges when both packs are enabled.
        - Resolver does NOT enforce this; it is informational.


unsupportedPacks (optional)
    Type: array of (PackRefString OR object with "id" and "reason")

    Example:
        "unsupportedPacks": [
          {
            "id": "OtherDev@old-combat@<2",
            "reason": "Conflicts with new damage model"
          }
        ]

    Semantics:
        - "These packs are known incompatible or broken with this pack."
        - Mod/Packs Manager may:
            - warn when a user tries to enable them together,
            - or optionally block the combination depending on policy.
        - Resolver by default does NOT hard-block; conflict handling is a
          higher-level policy.
