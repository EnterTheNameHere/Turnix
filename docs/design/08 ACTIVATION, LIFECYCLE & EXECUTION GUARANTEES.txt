===============================================================================
DESIGN AREA 8 - ACTIVATION, LIFECYCLE & EXECUTION GUARANTEES
===============================================================================

Status:
-------
CORE - this area defines when pack code is permitted to execute, under whose
authority execution occurs, and which execution behaviors Turnix explicitly
guarantees or does not guarantee.

Activation is the sole mechanism that transitions a pack from inert metadata
to an executable participant under Turnix control.


===============================================================================
1. CORE CONCEPT
===============================================================================

Activation answers exactly one question:

    "Is this pack permitted to execute code under Turnix orchestration?"

Activation is a controlled, explicit, one-time state transition.

Before activation:
- a pack exists only as metadata
- its code has no execution authority under Turnix

After activation:
- the pack may participate in runtime behavior
- execution is allowed only through Turnix-controlled orchestration pathways

Activation is NOT:
- discovery
- indexing
- dependency resolution
- importing
- visibility granting

Those phases may occur before activation, but NEVER imply it.


===============================================================================
2. LIFECYCLE PHASES (LOCKED)
===============================================================================

Turnix operates in logically ordered, externally observable phases:

1) Discovery
2) Indexing
3) Resolution
4) Activation
5) Running / Finalized

Execution guarantee boundary:
- Activation is the FIRST moment Turnix may intentionally execute pack code.
- After activation, pack code MAY execute during Running, but ONLY through
  Turnix-orchestrated execution pathways (see Section 14).

Any code that executes outside Turnix orchestration is outside Turnix guarantees.


===============================================================================
3. WHAT "ACTIVATED" MEANS (LOCKED)
===============================================================================

When a pack is activated:
- Turnix creates a PackContext (ctx) for that pack instance
- the pack's activation entrypoint is invoked
- the pack may:
    - register services
    - register capabilities
    - subscribe to Turnix events
    - allocate runtime resources
    - participate in Turnix-managed orchestration

Before activation:
- pack metadata may be resolved
- pack may appear in graphs
- pack code MUST NOT execute under Turnix authority


===============================================================================
4. PACK-LEVEL ACTIVATION (LOCKED)
===============================================================================

Activation applies to the pack as a whole.

Activation does NOT apply to:
- individual files
- individual modules
- individual imports
- individual capabilities

A pack is either activated or not activated.
There is no partial, staged, deferred, or per-file activation.


===============================================================================
5. PACKCONTEXT (ctx) - EXECUTION AUTHORITY (LOCKED)
===============================================================================

Turnix provides exactly one execution authority object to pack code:
the PackContext (ctx).

LOCKED:
- PackContext is created only by Turnix
- PackContext is bound to exactly one pack instance
- PackContext represents execution authority on behalf of that pack

Any code executing with a PackContext:
- executes under the authority of that pack
- is subject to that pack's visibility, permissions, and policy

Passing ctx to other code is an explicit delegation of authority.
The delegating pack is fully responsible for all actions performed using its ctx.


===============================================================================
6. ACTIVATION ENTRYPOINT (LOCKED)
===============================================================================

The sole activation entrypoint is:
    onLoad(ctx)

Rules:
- onLoad(ctx) is called exactly once per pack instance
- it is called only by Turnix
- ctx is always provided by Turnix
- failure aborts activation of that pack

No other function, construct, or mechanism may activate a pack.

Future activation entrypoints, if introduced, MUST follow the same rules and
MUST be explicitly defined by Turnix.


===============================================================================
7. ACTIVATION VS EXECUTION (CRITICAL DISTINCTION)
===============================================================================

Activation and execution are distinct concepts.

Activation:
- is a one-time state transition
- establishes PackContext authority
- is performed exclusively via onLoad(ctx)

Execution:
- occurs only AFTER activation
- may happen multiple times
- occurs only when invoked by Turnix orchestration

No execution mechanism activates a pack.
No execution mechanism substitutes for onLoad(ctx).


===============================================================================
8. IMMEDIATE EXECUTION & LANGUAGE CONSTRUCTS (LOCKED)
===============================================================================

Turnix acknowledges that some languages permit immediate execution constructs,
including but not limited to:
- Immediately Invoked Function Expressions (IIFE)
- module-level executable statements
- top-level side effects

RULES (LOCKED):
- Turnix does NOT rely on, endorse, or coordinate immediate execution
- immediate execution is DISCOURAGED in all pack code
- immediate execution does NOT activate a pack
- immediate execution runs outside Turnix orchestration

Code that executes immediately on import:
- runs without PackContext authority
- is not tracked by Turnix
- is outside lifecycle guarantees
- is not recoverable or abortable by Turnix

Such execution may technically occur, but its behavior is unsupported.
All consequences are the responsibility of the pack author.

These rules apply uniformly to:
- Python
- JavaScript
- and any future supported language


===============================================================================
9. RUNTIME ENTRIES - JAVASCRIPT SEMANTICS (LOCKED)
===============================================================================

Manifest fields:
    runtimes.javascript.entry
    runtimes.javascript.entries

Semantics:

runtimes.javascript.entry:
- imported by Turnix during activation
- onLoad(ctx) is invoked from this module
- successful completion marks JavaScript activation success

runtimes.javascript.entries:
- are never imported automatically by Turnix
- never receive ctx automatically
- never have onLoad(ctx) invoked
- are treated strictly as library modules


===============================================================================
10. ENTRY VS ENTRIES - EXECUTION RULES (LOCKED)
===============================================================================

If runtimes.javascript.entry exists:
- it MUST be executed before any pack code relies on activation state
- entries MUST NOT assume activation unless enforced by caller logic

If runtimes.javascript.entry does NOT exist:
- no JavaScript code is executed during activation
- the pack may still activate based on non-JS activation requirements

If only runtimes.javascript.entries exist:
- the pack is treated as a library-only pack
- all modules MUST be activation-independent


===============================================================================
11. ACTIVATION-INDEPENDENT CODE (LOCKED)
===============================================================================

Activation-independent code:
- MUST NOT assume its own pack is activated
- MUST NOT implicitly depend on ctx
- MUST NOT perform Turnix side effects at module top level

Such code MAY:
- accept a PackContext explicitly as a parameter
- execute under the authority of the caller pack providing that ctx

In this case:
- the caller pack owns responsibility
- authority is that of the caller, not the provider

If code requires activation-specific state of its own pack,
it MUST be initialized from that pack's activation entry.


===============================================================================
12. ACTIVATION ORDER (LOCKED RESPONSIBILITY)
===============================================================================

Activation order is determined exclusively by:
- PackManager
- resolved dependencies
- visibility constraints
- user policy
- future category-based ordering

Packs MUST NOT assume:
- another pack is activated unless explicitly required
- services exist unless explicitly requested
- capabilities are available unless explicitly granted


===============================================================================
13. resolvePack vs ensureActivated (LOCKED)
===============================================================================

resolvePack(selector):
- resolves metadata
- performs visibility checks
- does NOT execute code
- does NOT activate packs

ensureActivated(selector):
- ensures the target pack is activated
- may trigger activation
- returns activation metadata only
- activation metadata is immutable and diagnostic
- does NOT return code or symbols
- may raise NotActivatedError


===============================================================================
14. ORCHESTRATED EXECUTION GUARANTEE (LOCKED)
===============================================================================

Turnix guarantees behavior ONLY for execution invoked and tracked through
Turnix orchestration.

Guaranteed execution pathways include:
- activation entrypoints (onLoad(ctx))
- capability calls dispatched by Turnix
- Turnix event dispatch (handlers registered through Turnix)
- Turnix-managed schedulers (future)
- IoManager-mediated operations (including streaming reads and writes)

Execution started outside Turnix orchestration is UNSUPPORTED.

Unsupported execution may still run, but Turnix provides:
- no guarantees
- no tracing
- no lifecycle control
- no cleanup


===============================================================================
15. ACTIVATION FAILURE & NotActivatedError (LOCKED)
===============================================================================

Activation failure indicates a system-level error, including:
- unresolved dependency
- policy violation
- visibility violation
- activation entry failure

LOCKED:
- activation failure leaves the pack inactive
- dependent activations MUST NOT proceed
- failure MUST be surfaced to the user
- silent fallback is forbidden

NotActivatedError MUST NOT be swallowed by pack code.
Doing so hides orchestration failure.


===============================================================================
16. ACTIVATION RESULT (LOCKED)
===============================================================================

ensureActivated may return:
- activation status
- warnings
- diagnostics

It MUST NOT return:
- executable code
- module namespaces
- runtime symbols


===============================================================================
17. OPEN QUESTIONS
===============================================================================

OPEN:
- category-based activation ordering
- staged or phased activation
- activation retry semantics


===============================================================================
18. LOCKED SUMMARY
===============================================================================

LOCKED:
- activation is explicit and pack-level
- onLoad(ctx) is the ONLY activation entrypoint
- activation establishes execution authority
- execution is allowed only after activation
- immediate execution (IIFE, top-level code) is unsupported
- execution requires Turnix orchestration
- PackContext defines authority
- activation != import != resolution
- failures are visible and abort activation

OPEN:
- ordering refinements only


===============================================================================
END OF DESIGN AREA 8 - ACTIVATION, LIFECYCLE & EXECUTION GUARANTEES
===============================================================================


--- doc-meta ---
docId: docs/design/08 ACTIVATION, LIFECYCLE & EXECUTION GUARANTEES.txt
rev: 5
git: d5725d4
----------------
