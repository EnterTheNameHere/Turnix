======================================================================
DESIGN AREA 12 — TRACING, DIAGNOSTICS & OBSERVABILITY
======================================================================

Status:
-------
CORE — this area defines *how Turnix observes itself*, *how decisions are
explained*, and *how failures can be reconstructed after the fact*.

Tracing is not logging.
Tracing is structural truth.


----------------------------------------------------------------------
1. CORE CONCEPT
----------------------------------------------------------------------

Tracing answers:

    “What happened, in what order, and why?”

It must support:
- debugging
- user explanation
- post-mortem analysis
- reproducibility


----------------------------------------------------------------------
2. TRACE FIRST, LOG SECOND (LOCKED)
----------------------------------------------------------------------

Turnix prioritizes:
- structured trace events
- explicit reasons
- causal relationships

Plain logs are secondary and optional.


----------------------------------------------------------------------
3. TRACE EVENT MODEL (LOCKED)
----------------------------------------------------------------------

Each trace event has:

- eventId
- timestamp
- level (info | warn | error | fatal)
- domain (discovery, resolution, activation, io, capability, etc.)
- message (human-readable)
- reason (PascalCase enum)
- attributes (structured key-value data)
- optional parentEventId

Events form a DAG, not a flat stream.


----------------------------------------------------------------------
4. TRACE REASONS (LOCKED)
----------------------------------------------------------------------

Reasons are:
- stable identifiers
- PascalCase
- machine-parseable

Examples:
- ManifestInRootLayerDir
- SymlinkForbidden
- ScanDepthLimitReached
- PermissionDenied
- NotActivated
- SemVerParseError

Reasons MUST be emitted whenever a decision is made.


----------------------------------------------------------------------
5. TRACE DURING DISCOVERY (LOCKED)
----------------------------------------------------------------------

Discovery emits trace events for:
- manifest found
- manifest skipped
- manifest rejected
- depth limit reached
- symlink refusal

No silent skipping allowed.


----------------------------------------------------------------------
6. TRACE DURING RESOLUTION (LOCKED)
----------------------------------------------------------------------

Resolution emits:
- candidate sets
- filters applied
- soft vs hard rejections
- scoring results
- ambiguity detection
- user decision points

Resolution traces must be sufficient to replay logic offline.


----------------------------------------------------------------------
7. TRACE DURING ACTIVATION (LOCKED)
----------------------------------------------------------------------

Activation emits:
- activation start
- dependency activation ordering
- entrypoint invocation
- service/capability registration
- activation failure/success

Activation traces define runtime causality.


----------------------------------------------------------------------
8. CAPABILITY CALL TRACING (LOCKED)
----------------------------------------------------------------------

Every capability call emits:
- caller pack
- target capability
- permission decision
- execution outcome
- duration

This is mandatory for trust and audit.


----------------------------------------------------------------------
9. TRACE STORAGE (LOCKED POLICY)
----------------------------------------------------------------------

Trace data:
- best-effort persistence
- never blocks execution
- rotating / bounded storage
- safe to drop under pressure

Failure to write traces is OPTIONAL severity.


----------------------------------------------------------------------
10. TRACE ACCESS (LOCKED)
----------------------------------------------------------------------

Trace access via:
- TraceMonitor UI
- backend APIs
- exportable formats (future)

No direct file scraping.


----------------------------------------------------------------------
11. USER-FACING DIAGNOSTICS (LOCKED)
----------------------------------------------------------------------

Trace events may be surfaced to users as:
- warnings
- explanations
- prompts
- error dialogs

But raw trace data remains developer-facing.


----------------------------------------------------------------------
12. ERROR ENVELOPE INTEGRATION (LOCKED)
----------------------------------------------------------------------

All errors include:
- error code
- message
- reason
- trace correlation ids

Errors and traces are inseparable.


----------------------------------------------------------------------
13. DEV-MODE ENHANCEMENTS (LOCKED)
----------------------------------------------------------------------

Development mode may add:
- verbose traces
- speculative branches
- “why not chosen” explanations

Never enabled silently in production.


----------------------------------------------------------------------
14. NO HEURISTIC SUPPRESSION (LOCKED)
----------------------------------------------------------------------

Turnix MUST NOT:
- suppress “obvious” traces
- collapse distinct decisions
- infer reasons without recording them

Explicit beats clever.


----------------------------------------------------------------------
15. OPEN QUESTIONS
----------------------------------------------------------------------

OPEN:
- trace visualization schemas
- time-travel replay tooling
- cross-session trace stitching


----------------------------------------------------------------------
16. LOCKED SUMMARY
----------------------------------------------------------------------

LOCKED:
- structured tracing everywhere
- stable PascalCase reasons
- causal DAG model
- full resolution/activation coverage
- capability auditing

OPEN:
- visualization & tooling only


----------------------------------------------------------------------
END OF DESIGN AREA 12
----------------------------------------------------------------------

