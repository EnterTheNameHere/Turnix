===============================================================================
DESIGN AREA 2 - ROOT SYSTEM & PACK DISCOVERY BOUNDARIES
===============================================================================

Status:
-------
CORE INFRASTRUCTURE - affects discovery, visibility, persistence, and user
expectations. Decisions here strongly constrain all later phases.

Purpose:
--------
This area defines where Turnix looks for content, what it considers eligible
for discovery, and what is explicitly ignored.

The root system is not merely a filesystem detail; it encodes:
- trust boundaries
- override semantics
- authoring vs runtime separation
- determinism guarantees


===============================================================================
1. ROOT TYPES (LOCKED)
===============================================================================

Turnix recognizes the following root categories:
- custom/
- first-party/
- third-party/
- userdata/
- saves/

Each root has a distinct semantic meaning and enforced constraints.


1.1 CONTENT ROOTS
-----------------

Content roots are:
- custom/
- first-party/
- third-party/

These roots are scanned for packs (manifests).

Precedence (highest wins):
    custom
    first-party
    third-party

Rationale:
- custom      -> local overrides, authoring, experimentation
- first-party -> shipped baseline content
- third-party -> external content that must not silently override baseline

This precedence is LOCKED and reused consistently across:
- resolution ordering
- deterministic selection
- tie-breaking


1.2 USERDATA ROOT
-----------------

userdata/ is NOT a content root.

It is used exclusively for:
- persisted configuration
- runtime state
- user decisions
- caches

userdata/ MUST NEVER be scanned for packs.


1.3 SAVES ROOT
--------------

saves/ contains SavePacks.

LOCKED:
- SavePacks are discoverable as save entities
- SavePacks are NOT eligible for import as normal packs
- Packs copied into saves are context-bound to that save only

Default behavior:
- shallow scanning only (see Section 5)


===============================================================================
2. DISCOVERY ENTRY POINT RULES (LOCKED)
===============================================================================

2.1 ROOT DIRECTORIES ARE NOT PACKS
----------------------------------

A manifest located directly in a root directory is ignored.

Examples:
- first-party/manifest.json5
- custom/manifest.json5
- saves/manifest.json5

Reason:
- roots define namespaces, not packs
- prevents accidental global packs
- avoids ambiguity

This condition is NOT an error.


2.2 DISCOVERY OUTCOME TRACEABILITY
----------------------------------

Every ignored, skipped, or rejected discovery artifact MUST be traceable.

Discovery MUST NOT silently ignore:
- manifests
- directories
- files that appear eligible

How discovery decisions are traced, structured, and surfaced is defined in:
    DESIGN AREA 12 - Tracing, Diagnostics & Observability

DA-02 defines what must be traceable, not how tracing works.


===============================================================================
3. DIRECTORY SCANNING RULES
===============================================================================

3.1 MANIFEST-BASED DEPTH (LOCKED)
--------------------------------

Discovery depth is defined by manifest nesting, not filesystem nesting.

Example:
    first-party/a/manifest.json5        -> depth 0
    first-party/a/b/c/d/manifest.json5  -> still depth 0

Depth increases only when scanning below a discovered manifest.

This rule is LOCKED.


3.2 MAXIMUM SCAN DEPTH (LOCKED)
-------------------------------

Configuration key:
    packs.discovery.totalDepth

Rules:
- totalDepth <= 0   -> unlimited
- totalDepth == 1   -> scan only immediate subdirectories
- totalDepth >= 2   -> exact recursion limit

Default:
    totalDepth = 60

Behavior:
- exceeding the limit stops recursion
- discovery continues elsewhere
- no fatal error is raised

Rationale:
- protects against runaway directory trees
- allows controlled overrides for exotic layouts


3.3 SYMLINK HANDLING (LOCKED)
-----------------------------

By default:
- directory symlinks are forbidden
- file symlinks are forbidden

Rationale:
- determinism
- security
- prevention of implicit graph expansion

Policy-based relaxation MAY be introduced later.
Discovery behavior remains deterministic regardless.


===============================================================================
4. DISCOVERY OUTPUT (LOCKED)
===============================================================================

Discovery produces PackDescriptor objects in Discovered state.

At discovery time:
- manifest is read
- declared fields are parsed and type-checked
- parent relationships are established
- packTreeId is computed
- raw manifest data is preserved

Discovery MUST NOT:
- determine resolution source (save vs global)
- resolve visibility
- apply user enable/disable policy
- parse selectors
- activate packs
- load runtimes
- require compilers or providers

If a pack cannot be discovered correctly:
- it is rejected
- the reason is recorded
- discovery proceeds


===============================================================================
5. SAVE DISCOVERY POLICY
===============================================================================

5.1 DEFAULT SAVE SCANNING (LOCKED)
----------------------------------

By default, Turnix scans:
    saves/*/*/manifest.json5

It MUST NOT:
- recurse into save directories
- discover copied packs eagerly

Rationale:
- typical saves do not embed packs
- exported saves may contain many packs
- eager scanning would be expensive and unnecessary


5.2 DEEP SAVE SCANNING
----------------------

Deep scanning of save contents occurs ONLY when:
- a save is explicitly loaded
- PackManager inspects a save
- configuration explicitly enables deep save scanning

At that point:
- copied packs are discovered
- visibility is limited to save context
- copied-pack rules apply

This separation is LOCKED.


===============================================================================
6. DISCOVERY GUARANTEES
===============================================================================

LOCKED guarantees:
- Discovery is fast and side-effect free
- Discovery does not depend on packs
- All heavy logic belongs to indexing or activation
- Discovery failures are classified, not fatal
  (unless core configuration is missing)


===============================================================================
7. OPEN QUESTIONS
===============================================================================

OPEN:
- per-root default depth limits
- per-root symlink policies
- incremental vs full discovery
- discovery result caching


===============================================================================
8. WHY THIS AREA EXISTS
===============================================================================

Without strict discovery boundaries:
- visibility rules become impossible to reason about
- resolution loses determinism
- performance degrades unpredictably
- user trust erodes due to "ghost packs"
- save isolation breaks

Discovery must be boring, strict, and predictable.


===============================================================================
END OF DESIGN AREA 2 - ROOT SYSTEM & PACK DISCOVERY BOUNDARIES
===============================================================================


--- doc-meta ---
docId: docs/design/02 ROOT SYSTEM & PACK DISCOVERY BOUNDARIES.txt
rev: 4
git: 3a6b160
----------------
